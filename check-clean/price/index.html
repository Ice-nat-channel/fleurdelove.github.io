<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Fleur de Love | Flower Shop</title>
  <link href="https://fonts.googleapis.com/css2?family=Mali:wght@300;400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../style.css">
  <link rel="icon" href="../icon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="../icon.ico">
</head>
<body>
  <a class="skip-link" href="#price">Skip to content</a>

<header>
  <h1>Fleur de Love</h1>
  <p>ดอกไม้แทนความรู้สึก ส่งต่อความรักในทุกโอกาส</p>
</header>

<nav class="site-nav" aria-label="Main navigation">
  <div class="nav-inner">
    <button type="button" class="nav-toggle" aria-expanded="false" aria-controls="primary-navigation" aria-label="Open navigation">
      <span class="hamburger" aria-hidden="true"></span>
    </button>
    <div id="primary-navigation" class="nav-links" aria-hidden="true">
      <a href="../home/">Home</a>
      <a href="../price/">Price</a>
      <a href="../gallery/">Gallery</a>
      <a href="../contact/">Contact</a>
    </div>
  </div>
</nav>

<main class="page-content">

<section id="price" class="full-viewport" id="priceSection">
  <!-- Products will be loaded here from admin dashboard -->
</section>

</main>

<footer>
  © 2026 Fleur de Love | By N.Parin | <a href="/admin/login.html" style="color: inherit; text-decoration: none; opacity: 0.7; transition: opacity 0.3s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">Admin</a>
</footer>

<script>
  // Load products from admin dashboard or Firestore
  function loadProducts() {
    const products = JSON.parse(localStorage.getItem('products')) || [];
    const priceSection = document.getElementById('price');
    const storeSettings = JSON.parse(localStorage.getItem('storeSettings') || '{}');
    
    if (products.length === 0) {
      priceSection.innerHTML = '<div class="card"><p style="text-align: center; color: #999;">ยังไม่มีสินค้า กรุณาไปที่ Admin Dashboard เพื่อเพิ่มสินค้า</p></div>';
      return;
    }
    
    priceSection.innerHTML = '';
    
    products.forEach(product => {
      const unit = product.quantityUnit || storeSettings.quantityUnit || 'ชิ้น';
      const card = document.createElement('div');
      card.className = 'card';
      // Build price tier HTML
      let priceHtml = '';
      if (product.prices && product.prices.length > 0) {
          product.prices.forEach(tier => {
            priceHtml += `<li><span class="price-qty">${tier.quantity} ${unit}</span><span class="price-amt">฿${tier.price}</span></li>`;
          });
      } else if (product.price) {
        // Fallback for old format
        priceHtml = `<li><span class="price-qty">ราคา</span><span class="price-amt">฿${product.price}</span></li>`;
      }
      
      const stockRow = product.unlimitedStock
          ? ''
          : `<li><span class="price-qty">คงเหลือ</span><span class="price-amt">${product.stock} ${unit}</span></li>`;
      // Build items HTML (optional list of name + priceText)
      let itemsHtml = '';
      if (product.items && product.items.length > 0) {
        itemsHtml = '<div style="background:#fff;border-radius:12px;padding:14px;margin:10px 0 16px;box-shadow:0 8px 24px rgba(0,0,0,0.06);">';
        product.items.forEach(it => {
          const name = it.name || '';
          const priceText = it.priceText || '';
          itemsHtml += `<div style="display:flex;align-items:flex-start;justify-content:space-between;padding:6px 2px;border-radius:8px;">` +
                       `<div style="font-weight:700;color:#5a3b3b;">${name}</div>` +
                       `<div style="color:#c97a8a;font-weight:700;white-space:nowrap;margin-left:12px;">${priceText}</div>` +
                       `</div>`;
        });
        itemsHtml += '</div>';
      }

      card.innerHTML = `
        <h2>${product.name}</h2>
        <p style="color: #666; font-size: 14px; margin-bottom: 8px;">${product.description || ''}</p>
        ${itemsHtml}
        <ul class="price-list" aria-label="${product.name} prices">
          ${priceHtml}
          ${stockRow}
        </ul>
      `;
      priceSection.appendChild(card);
    });
  }

  // Load on page load
  window.addEventListener('DOMContentLoaded', function() {
    initPublicSync().then(()=>{
      loadProducts();
    }).catch(()=>{
      loadProducts();
    });
    document.documentElement.classList.add('is-loaded');
  });
</script>

<!-- Public Firestore sync: optional, loads admin/firebase-config.js then reads site/shared -->
<script>
  function loadScript(src){ return new Promise(function(resolve,reject){ var s=document.createElement('script'); s.src=src; s.onload=resolve; s.onerror=reject; document.head.appendChild(s); }); }

  async function initPublicSync(){
    try{
      // Try to load optional config placed at /admin/firebase-config.js
      await new Promise((res)=>{
        var cfg = document.createElement('script'); cfg.src = '/admin/firebase-config.js'; cfg.async = false; cfg.onload = res; cfg.onerror = res; document.head.appendChild(cfg);
      });
      if (!window.FIREBASE_CONFIG || !window.FIREBASE_CONFIG.apiKey) return;
      if (typeof firebase === 'undefined') await loadScript('https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js');
      if (typeof firebase.firestore === 'undefined') await loadScript('https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js');
      try{ firebase.initializeApp(window.FIREBASE_CONFIG); }catch(e){}
      const db = firebase.firestore();
      const docRef = db.collection('site').doc('shared');
      // read once and populate localStorage then re-render
      const snap = await docRef.get();
      if (snap && snap.exists){
        const data = snap.data() || {};
        if (data.products) localStorage.setItem('products', JSON.stringify(data.products));
        if (data.storeSettings) localStorage.setItem('storeSettings', JSON.stringify(data.storeSettings));
      }
    }catch(e){ console.warn('Public sync failed', e); }
  }
</script>

<script>
  (function(){
    const btn = document.querySelector('.nav-toggle');
    const nav = document.querySelector('.site-nav .nav-links');
    if (!btn || !nav) return;
    function openNav(){ console.log('[nav] openNav called'); nav.classList.add('visible'); nav.setAttribute('aria-hidden','false'); btn.setAttribute('aria-expanded','true'); document.documentElement.classList.add('menu-open'); btn.classList.add('toggled'); const first = nav.querySelector('a'); if (first && window.matchMedia && window.matchMedia('(hover: hover)').matches) first.focus(); console.log('[nav] visible after open', nav.classList.contains('visible')); }
    function closeNav(){ console.log('[nav] closeNav called'); nav.classList.remove('visible'); nav.setAttribute('aria-hidden','true'); btn.setAttribute('aria-expanded','false'); document.documentElement.classList.remove('menu-open'); btn.classList.remove('toggled'); btn.focus(); console.log('[nav] visible after close', nav.classList.contains('visible')); }
    btn.addEventListener('click', function(e){ console.log('[nav] toggle click', e.target); e.preventDefault(); e.stopPropagation(); e.stopImmediatePropagation(); btn.classList.add('clicked'); setTimeout(() => btn.classList.remove('clicked'), 360); if (nav.classList.contains('visible')) { closeNav(); } else { openNav(); } }, true);
    document.addEventListener('click', function(e){ console.log('[nav] document click', e.target); if (!nav.contains(e.target) && !btn.contains(e.target)) closeNav(); });
    document.addEventListener('keydown', function(e){ if (e.key === 'Escape') closeNav(); });
    function checkWidth(){ if (window.matchMedia('(min-width:700px)').matches){ nav.classList.remove('visible'); nav.setAttribute('aria-hidden','false'); btn.setAttribute('aria-expanded','false'); document.documentElement.classList.remove('menu-open'); } else { nav.setAttribute('aria-hidden','true'); } }
    window.addEventListener('resize', checkWidth);
    checkWidth();
  })();
</script>

<!-- Click sound: plays a short click on interactive elements -->
<script>
  (function(){
    if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
    const src = '/assets/click.mp3';
    const poolSize = 6;
    const pool = [];
    for (let i=0;i<poolSize;i++){ const a = new Audio(src); a.preload='auto'; a.volume=0.45; pool.push(a); }
    let idx = 0;
    function play(){ try{ const a = pool[idx]; a.currentTime = 0; a.play(); idx = (idx+1)%poolSize; }catch(e){console.warn('click audio failed', e)} }
    const selector = 'a, button, .btn, [role="button"], input[type="button"], input[type="submit"], .gallery-item';

    document.addEventListener('click', function(e){
      if (e.button !== 0) return;
      if (e.defaultPrevented) return;
      if (e.metaKey || e.ctrlKey || e.shiftKey || e.altKey) return;
      const el = e.target.closest(selector);
      if (!el) return;
      if (el.classList && el.classList.contains('nav-toggle')) return; 

      // For same-origin navigation, delay navigation slightly so sound can play
      if (el.tagName === 'A' && el.href) {
        try {
          const url = new URL(el.href, location.href);
          const isSameOrigin = url.origin === location.origin;
          const isHashOnly = url.pathname === location.pathname && url.hash;
          const isExternal = el.target === '_blank' || el.hasAttribute('download');
          if (isSameOrigin && !isHashOnly && !isExternal) {
            e.preventDefault();
            play();
            setTimeout(() => { location.href = url.href; }, 160);
            return;
          }
        } catch(e) {}
      }

      play();
    }, true);

    // Keyboard activation (Enter / Space)
    document.addEventListener('keydown', function(e){
      if (e.defaultPrevented) return;
      if (e.key !== 'Enter' && e.key !== ' ') return;
      const el = document.activeElement;
      if (!el || !el.matches(selector)) return;

      if (el.tagName === 'A' && el.href) {
        try {
          const url = new URL(el.href, location.href);
          const isSameOrigin = url.origin === location.origin;
          const isHashOnly = url.pathname === location.pathname && url.hash;
          const isExternal = el.target === '_blank' || el.hasAttribute('download');
          if (isSameOrigin && !isHashOnly && !isExternal) {
            e.preventDefault();
            play();
            setTimeout(() => { location.href = url.href; }, 160);
            return;
          }
        } catch(e) {}
      }

      play();
    }, true);

  })();
</script>

</body>
</html>
